<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Responsive Sidebar</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Nunito:ital,wght@0,200..1000;1,200..1000&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <section class="container-fluid p-0">
      <div class="container-fluid p-0">
        <div class="container-fluid bs-light-bg-subtle p-0">
          <nav class="py-2 d-flex justify-content-evenly row m-0">
            <!-- Brand name-->
            <div
              class="nav-header d-flex justify-content-center col-12 col-md-3"
            >
              <h4
                class="text-white roboto text-black-50 d-flex justify-content-center align-items-center"
              >
                Cruise Care
              </h4>
            </div>
            <!-- menu icon-->
            <!-- Menu button -->
            <div class="menu-i d-flex align-items-center col-3 col-md-1">
              <div
                class="menu-icon d-flex justify-content-center"
                id="toggleSidebar"
              >
                <i class="bi bi-list" style="font-size: 20px"></i>
              </div>
            </div>
            <div
              class="d-flex align-items-center justify-content-end gap-3 other-info col-5 col-md-7"
            >
              <!-- Moon Icon -->
              <div class="icon-btn d-flex">
                <i class="bi bi-moon"></i>
              </div>

              <!-- Notification Icon with Ring -->
              <div class="icon-btn icon-ring d-flex">
                <i class="bi bi-bell"></i>
              </div>

              <!-- Chat Icon -->
              <div class="icon-btn d-md-flex">
                <i class="bi bi-chat"></i>
              </div>

              <!-- Flag Icon (USA as example) -->
              <img
                src="https://flagcdn.com/ng.svg"
                alt="USA"
                width="24"
                height="24"
                style="border-radius: 4px"
              />

              <!-- Fullscreen Icon -->
              <div class="icon-btn d-md-flex">
                <i class="bi bi-arrows-fullscreen"></i>
              </div>

              <!-- Grid Icon -->
              <div class="icon-btn d-md-flex">
                <i class="bi bi-sliders"></i>
              </div>

              <!-- Avatar -->
              <img
                src="https://i.pravatar.cc/36?img=12"
                alt="Avatar"
                class="profile-avatar"
              />
            </div>
          </nav>
        </div>
        <div class="main-content m-0">
          <!-- Sidebar -->
          <div class="sidebar" id="sidebar">
            <div class="sidebar-content">
              <ul class="list-unstyled m-0">
                <li class="navs d-flex align-items-center gap-2 p-3 dm-sans">
                  <i class="bi bi-people"></i> Customers
                </li>
                <li class="navs d-flex align-items-center gap-2 p-3 dm-sans">
                  <i class="bi bi-car-front-fill"></i> Vehicles
                </li>
                <li class="navs d-flex align-items-center gap-2 p-3 dm-sans">
                  <i class="bi bi-tools"></i> Services
                </li>
                <li class="navs d-flex align-items-center gap-2 p-3 dm-sans">
                  <i class="bi bi-calendar-check"></i> Schedules
                </li>
                <li class="navs d-flex align-items-center gap-2 p-3 dm-sans">
                  <i class="bi bi-gear"></i> Mechanics
                </li>
              </ul>
            </div>
          </div>

          <!-- Main content -->
          <div class="content p-4" id="content">
            <div class="stats-grid row">
              <!-- From Uiverse.io by akshat-patel28 -->
              <div class="col-12">
                <div class="card">
                  <p class="time-text">
                    <span>11:11</span><span class="time-sub-text">PM</span>
                  </p>
                  <p class="day-text">Wednesday, June 15th</p>
                </div>
              </div>
              <div class="col-12">
                <div class="weather-display">
                  <div class="weather-container">
                    <div class="weather-cloud front">
                      <span class="cloud-part left-front"></span>
                      <span class="cloud-part right-front"></span>
                    </div>
                    <span class="weather-sun sunshine"></span>
                    <span class="weather-sun"></span>
                    <div class="weather-cloud back">
                      <span class="cloud-part left-back"></span>
                      <span class="cloud-part right-back"></span>
                    </div>
                  </div>

                  <div class="display-header">
                    <span class="location">Loading...</span>
                    <span class="date"></span>
                  </div>

                  <span class="current-temp">--¬∞</span>

                  <div class="temp-unit">
                    <span>Celcius</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-header">
                  <span class="stat-title title-managing">üë§ Customers </span>
                </div>
                <div class="stat-values">
                  <div>
                    <span id="customer-count">Loading...</span>
                    <div class="stat-label">Total</div>
                  </div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-header">
                  <span class="stat-title title-current">üöó Vehicles </span>
                </div>
                <div class="stat-values">
                  <div>
                    <span id="vehicle-count">Loading...</span>
                    <div class="stat-label">Total</div>
                  </div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-header">
                  <span class="stat-title title-consumed"> üõ†Ô∏è Services </span>
                </div>
                <div class="stat-single">
                  <span id="service-count">Loading...</span>
                  <div class="stat-label">Total</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-header">
                  <span class="stat-title title-income">üìÖ Schedules </span>
                </div>
                <div class="stat-single">
                  <span id="schedule-count">Loading...</span>
                  <div class="stat-label">Total</div>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-header">
                  <span class="stat-title title-income">üßë‚Äçüîß Mechanics </span>
                </div>
                <div class="stat-single">
                  <span id="mechanic-count">Loading...</span>
                  <div class="stat-label">Total</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script>
      const sidebar = document.getElementById("sidebar");
      const toggleBtn = document.getElementById("toggleSidebar");

      toggleBtn.addEventListener("click", () => {
        sidebar.classList.toggle("collapsed");
      });
      function updateDateTime() {
        const now = new Date();

        // Get the time components
        let hours = now.getHours();
        const minutes = String(now.getMinutes()).padStart(2, "0");
        const ampm = hours >= 12 ? "PM" : "AM";
        hours = hours % 12 || 12; // Convert to 12-hour format

        // Get the day and date components
        const days = [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday",
        ];
        const day = days[now.getDay()];
        const date = now.getDate();

        // Function to get the ordinal suffix for the date
        function getOrdinalSuffix(n) {
          const s = ["th", "st", "nd", "rd"];
          const v = n % 100;
          return s[(v - 20) % 10] || s[v] || s[0];
        }

        const dateWithSuffix = date + getOrdinalSuffix(date);

        // Update the HTML elements
        document.querySelector(
          ".time-text span:first-child"
        ).textContent = `${hours}:${minutes}`;
        document.querySelector(".time-text .time-sub-text").textContent = ampm;
        document.querySelector(
          ".day-text"
        ).textContent = `${day}, ${getMonthName(
          now.getMonth()
        )} ${dateWithSuffix}`;
      }

      function getMonthName(monthIndex) {
        const months = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December",
        ];
        return months[monthIndex];
      }

      // Call the function to update the time and date when the page loads
      updateDateTime();

      // Optionally, update the time every second (1000 milliseconds)
      setInterval(updateDateTime, 1000);
      const locationElement = document.querySelector(".location");
      const dateElement = document.querySelector(".date");
      const tempElement = document.querySelector(".current-temp");
      const openCageApiKey = "3a21d953dd87459abd92b9890e52d0fb"; // Your API key

      function updateDate() {
        const now = new Date();
        const options = { year: "numeric", month: "long", day: "numeric" };
        dateElement.textContent = now.toLocaleDateString(undefined, options);
      }

      async function fetchWeatherData() {
        try {
          // First, try to get the user's location
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
              async (position) => {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;

                // Use a reverse geocoding service to get the city and country
                const geoApiUrl = `https://api.opencagedata.com/geocode/v1/json?q=${latitude},${longitude}&key=3a21d953dd87459abd92b9890e52d0fb&language=en`;
                const geoResponse = await fetch(geoApiUrl);
                const geoData = await geoResponse.json();

                if (geoData.results && geoData.results.length > 0) {
                  const city =
                    geoData.results[0].components.city ||
                    geoData.results[0].components.town ||
                    geoData.results[0].components.village;
                  const country = geoData.results[0].components.country;
                  locationElement.textContent = `${city}, ${country}`;

                  // Now fetch the weather data based on the coordinates
                  const weatherApiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m&temperature_unit=celsius&timezone=Africa/Lagos`;
                  const weatherResponse = await fetch(weatherApiUrl);
                  const weatherData = await weatherResponse.json();

                  if (
                    weatherData.current &&
                    weatherData.current.temperature_2m !== undefined
                  ) {
                    tempElement.textContent = `${weatherData.current.temperature_2m}¬∞`;
                  } else {
                    tempElement.textContent = "Error";
                  }
                } else {
                  locationElement.textContent = "Location not found";
                  tempElement.textContent = "Error";
                }
              },
              (error) => {
                console.error("Error getting location:", error);
                locationElement.textContent = "Location access denied";
                tempElement.textContent = "Error";
                // Optionally, you could try a fallback to a default location or IP-based lookup here
              }
            );
          } else {
            locationElement.textContent = "Geolocation not supported";
            tempElement.textContent = "Error";
            // Optionally, you could try a fallback to a default location or IP-based lookup here
          }
        } catch (error) {
          console.error("Error fetching data:", error);
          locationElement.textContent = "Error";
          tempElement.textContent = "Error";
        }
      }

      updateDate();
      fetchWeatherData();

      window.addEventListener("DOMContentLoaded", () => {
        fetch("https://the-automobile-management-system.onrender.com/")
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("customer-count").textContent =
              data.max_customers ?? 0;
            document.getElementById("vehicle-count").textContent =
              data.max_vehicles ?? 0;
            document.getElementById("service-count").textContent =
              data.max_service_records ?? 0;
            document.getElementById("schedule-count").textContent =
              data.max_schedules ?? 0;
            document.getElementById("mechanic-count").textContent =
              data.max_mechanics ?? 0;
          })
          .catch((err) => {
            console.error("Error fetching counts:", err);
          });
      });
    </script>
  </body>
</html>
